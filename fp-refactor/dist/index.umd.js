(function(r,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(r=typeof globalThis<"u"?globalThis:r||self,n(r.CRMFingerprint={}))})(this,function(r){"use strict";var bt=Object.defineProperty;var at=r=>{throw TypeError(r)};var Ct=(r,n,u)=>n in r?bt(r,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):r[n]=u;var f=(r,n,u)=>Ct(r,typeof n!="symbol"?n+"":n,u),tt=(r,n,u)=>n.has(r)||at("Cannot "+u);var e=(r,n,u)=>(tt(r,n,"read from private field"),u?u.call(r):n.get(r)),c=(r,n,u)=>n.has(r)?at("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(r):n.set(r,u),d=(r,n,u,B)=>(tt(r,n,"write to private field"),B?B.call(r,u):n.set(r,u),u),Q=(r,n,u)=>(tt(r,n,"access private method"),u);var F,D,I,A,rt,it,p,x,T,M,O,j,$,E,U,S,L,y,V,m,N,st;function n(s){function t(h,w){return h>>>w|h<<32-w}const l=new TextEncoder().encode(s),a=Array.from(l),g=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],v=a.length*8;for(a.push(128);(a.length*8+64)%512!==0;)a.push(0);const R=new Array(8).fill(0);for(let h=0;h<8;h++)R[7-h]=v>>>h*8&255;a.push(...R);const H=[];for(let h=0;h<a.length;h+=64)H.push(a.slice(h,h+64));return H.forEach(h=>{const w=new Array(64);for(let o=0;o<16;o++)w[o]=h[o*4]<<24|h[o*4+1]<<16|h[o*4+2]<<8|h[o*4+3];for(let o=16;o<64;o++){const Y=t(w[o-15],7)^t(w[o-15],18)^w[o-15]>>>3,_=t(w[o-2],17)^t(w[o-2],19)^w[o-2]>>>10;w[o]=w[o-16]+Y+w[o-7]+_|0}let[b,P,z,W,C,J,K,X]=i;for(let o=0;o<64;o++){const Y=t(C,6)^t(C,11)^t(C,25),_=C&J^~C&K,nt=X+Y+_+g[o]+w[o]|0,yt=t(b,2)^t(b,13)^t(b,22),mt=b&P^b&z^P&z,vt=yt+mt|0;X=K,K=J,J=C,C=W+nt|0,W=z,z=P,P=b,b=nt+vt|0}i[0]=i[0]+b|0,i[1]=i[1]+P|0,i[2]=i[2]+z|0,i[3]=i[3]+W|0,i[4]=i[4]+C|0,i[5]=i[5]+J|0,i[6]=i[6]+K|0,i[7]=i[7]+X|0}),i.map(h=>(h>>>0).toString(16).padStart(8,"0")).join("")}const u="http://34.47.190.194";async function B(){try{const t=await(await fetch(`${u}/api/fp/ussd`)).json();if(!t)throw new Error("failed to get user request info");return t.serverData}catch(s){console.error("failed to get user request info",s)}}async function ot(s){return fetch(`${u}/api/fingerprint`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}class lt{constructor(){c(this,A);f(this,"name","Audio Feature");f(this,"enabled",!0);c(this,F,null);c(this,D,null);c(this,I,5e3)}async support(){const t=window.OfflineAudioContext||window.webkitOfflineAudioContext;return t?(d(this,F,new t(1,e(this,I),44100)),e(this,F)!==null):!1}async data(){if(e(this,F)===null)return null;const t=await Q(this,A,rt).call(this,e(this,F));return t===null?null:(d(this,D,t.toString()),{fingerprint:await n(e(this,D)),value:t})}}F=new WeakMap,D=new WeakMap,I=new WeakMap,A=new WeakSet,rt=function(t){return new Promise(l=>{const a=t.createOscillator();a.type="triangle",a.frequency.value=1e4;const g=t.createDynamicsCompressor();g.threshold.value=-50,g.knee.value=40,g.ratio.value=12,g.attack.value=0,g.release.value=.2,a.connect(g),g.connect(t.destination),a.start(),t.oncomplete=i=>{const v=i.renderedBuffer.getChannelData(0),R=Q(this,A,it).call(this,v);l(R)},t.startRendering()})},it=function(t){let l=0;for(let a=0;a<t.length;++a)l+=Math.abs(t[a]);return l};class ut{constructor(){f(this,"name","Canvas Feature");f(this,"enabled",!0);c(this,p,null);c(this,x,null)}async support(){return document?(d(this,p,document.createElement("canvas").getContext("2d")),e(this,p)!==null):!1}async data(){return e(this,p)===null?null:(e(this,p).textBaseline="top",e(this,p).font="14px 'Arial'",e(this,p).textBaseline="alphabetic",e(this,p).fillStyle="#f60",e(this,p).fillRect(100,1,55,20),e(this,p).fillStyle="#069",e(this,p).fillText("Cyber Universe Canvas",2,15),e(this,p).fillStyle="rgba(102, 204, 0, 0.7)",e(this,p).fillText("Cyber Universe Canvas",4,17),d(this,x,e(this,p).canvas.toDataURL()),{fingerprint:await n(e(this,x)),value:{image:e(this,x)}})}}p=new WeakMap,x=new WeakMap;const k=class k{constructor(){f(this,"name","Color Gamut Feature");f(this,"enabled",!0);c(this,T,null);c(this,M,null)}async support(){return!0}async data(){for(const t of k.gamutList){const l=`(color-gamut: ${t})`;if(matchMedia(l).matches){d(this,T,`gamut: ${t}`),d(this,M,t);break}}return e(this,T)===null?null:{fingerprint:await n(e(this,T)),value:e(this,M)}}};T=new WeakMap,M=new WeakMap,f(k,"gamutList",["rec2020","p3","srgb"]);let Z=k;const q=class q{constructor(){f(this,"name","HDR Feature");f(this,"enabled",!0);c(this,O,null);c(this,j,null)}async support(){return!0}async data(){for(const t of q.hdrList){const l=`(dynamic-range: ${t})`;if(matchMedia(l).matches){d(this,O,`dynamic-range: ${t}`),d(this,j,t);break}}return e(this,O)===null?null:{fingerprint:await n(e(this,O)),value:e(this,j)}}};O=new WeakMap,j=new WeakMap,f(q,"hdrList",["high","standard"]);let G=q;class ct{constructor(){f(this,"name","Hardware Concurrency Feature");f(this,"enabled",!0);c(this,$,null);c(this,E,null);c(this,U,null)}async support(){return!!navigator}async data(){return navigator.hardwareConcurrency&&(d(this,$,navigator.hardwareConcurrency.toString()),d(this,U,navigator.hardwareConcurrency)),e(this,$)?(d(this,E,"hardware concurrency: "+e(this,$)),{fingerprint:await n(e(this,E)),value:e(this,U)}):null}}$=new WeakMap,E=new WeakMap,U=new WeakMap;class ht{constructor(){f(this,"name","Languages Feature");f(this,"enabled",!0);c(this,S,[]);c(this,L,null)}async support(){return!!navigator}async data(){var t;return navigator.language&&e(this,S).push([navigator.language]),Array.isArray(navigator.languages)&&e(this,S).push(navigator.languages),(t=e(this,S))!=null&&t.length?(d(this,L,JSON.stringify(e(this,S))),{fingerprint:await n(e(this,L)),value:e(this,L)}):null}}S=new WeakMap,L=new WeakMap;class ft{constructor(){f(this,"name","Screen Resolution Feature");f(this,"enabled",!0);c(this,y,null);c(this,V,null)}async support(){if(!(window.OfflineAudioContext||window.webkitOfflineAudioContext))return!1;const l=window.screen;return l?(d(this,y,l),e(this,y)!==null):!1}async data(){if(e(this,y)===null)return null;const t=`${e(this,y).width} x ${e(this,y).height}`;return d(this,V,t),{fingerprint:await n(e(this,V)),value:t}}}y=new WeakMap,V=new WeakMap;class dt{constructor(){c(this,N);f(this,"name","Timezone Feature");f(this,"enabled",!0);c(this,m,null)}async support(){return!0}async data(){if(Intl.DateTimeFormat){const t=new Intl.DateTimeFormat().resolvedOptions().timeZone;d(this,m,t)}else d(this,m,Q(this,N,st).call(this));return e(this,m)===null?null:{fingerprint:await n(e(this,m)),value:e(this,m)}}}m=new WeakMap,N=new WeakSet,st=function(){const l=-new Date().getTimezoneOffset(),a=l>=0?"+":"-",g=Math.floor(Math.abs(l)/60).toString().padStart(2,"0"),i=(Math.abs(l)%60).toString().padStart(2,"0");return`UTC${a}${g}:${i}`};const pt=[new lt,new ut,new Z,new G,new ct,new ht,new ft,new dt];async function gt(s){return s.enabled?await s.support()?await s.data():(console.log(`Feature ${s.name} is not supported`),null):(console.log(`Feature ${s.name} is disabled`),null)}async function et(){var g;const s=[],t={},l={};for(const i of pt){const v=await gt(i);if(!v)continue;const R=i.name.replace(/\s/g,"").replace(/Feature$/,"").replace(/^[A-Z]/,H=>H.toLowerCase());t[R]={hash:v.fingerprint,value:v.value},s.push(v.fingerprint)}const a=await B();if(a!=null&&a.ip){const i=await n(a.ip);l.client_ip={hash:i,value:a.ip},s.push(i)}return{id:await n(JSON.stringify(s)),ip:(a==null?void 0:a.ip)||!1,useragent:((g=a==null?void 0:a.headers)==null?void 0:g["user-agent"])??!1,headers:(a==null?void 0:a.headers)??!1,rawData:t,serverFeature:l}}async function wt(){const s=await et();return(await(await ot(s)).json()).data}r.collectFingerprint=et,r.fpPromise=wt,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
