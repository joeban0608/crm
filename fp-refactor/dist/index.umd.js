(function(i,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(i=typeof globalThis<"u"?globalThis:i||self,n(i.CRMFingerprint={}))})(this,function(i){"use strict";var mt=Object.defineProperty;var nt=i=>{throw TypeError(i)};var bt=(i,n,c)=>n in i?mt(i,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[n]=c;var f=(i,n,c)=>bt(i,typeof n!="symbol"?n+"":n,c),_=(i,n,c)=>n.has(i)||nt("Cannot "+c);var e=(i,n,c)=>(_(i,n,"read from private field"),c?c.call(i):n.get(i)),u=(i,n,c)=>n.has(i)?nt("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(i):n.set(i,c),d=(i,n,c,I)=>(_(i,n,"write to private field"),I?I.call(i,c):n.set(i,c),c),K=(i,n,c)=>(_(i,n,"access private method"),c);var S,M,k,x,at,it,g,A,O,E,T,U,L,V,z,F,$,y,j,m,H,rt;function n(o){function t(h,w){return h>>>w|h<<32-w}const l=new TextEncoder().encode(o),a=Array.from(l),p=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],r=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],b=a.length*8;for(a.push(128);(a.length*8+64)%512!==0;)a.push(0);const R=new Array(8).fill(0);for(let h=0;h<8;h++)R[7-h]=b>>>h*8&255;a.push(...R);const tt=[];for(let h=0;h<a.length;h+=64)tt.push(a.slice(h,h+64));return tt.forEach(h=>{const w=new Array(64);for(let s=0;s<16;s++)w[s]=h[s*4]<<24|h[s*4+1]<<16|h[s*4+2]<<8|h[s*4+3];for(let s=16;s<64;s++){const X=t(w[s-15],7)^t(w[s-15],18)^w[s-15]>>>3,Y=t(w[s-2],17)^t(w[s-2],19)^w[s-2]>>>10;w[s]=w[s-16]+X+w[s-7]+Y|0}let[C,B,D,Z,v,J,P,W]=r;for(let s=0;s<64;s++){const X=t(v,6)^t(v,11)^t(v,25),Y=v&J^~v&P,et=W+X+Y+p[s]+w[s]|0,pt=t(C,2)^t(C,13)^t(C,22),wt=C&B^C&D^B&D,yt=pt+wt|0;W=P,P=J,J=v,v=Z+et|0,Z=D,D=B,B=C,C=et+yt|0}r[0]=r[0]+C|0,r[1]=r[1]+B|0,r[2]=r[2]+D|0,r[3]=r[3]+Z|0,r[4]=r[4]+v|0,r[5]=r[5]+J|0,r[6]=r[6]+P|0,r[7]=r[7]+W|0}),r.map(h=>(h>>>0).toString(16).padStart(8,"0")).join("")}const c="http://localhost:3000";async function I(){try{const t=await(await fetch(`${c}/api/fingerprint`)).json();if(!t)throw new Error("failed to get user request info");return t.serverData}catch(o){console.error("failed to get user request info",o)}}class st{constructor(){u(this,x);f(this,"name","Audio Feature");f(this,"enabled",!0);u(this,S,null);u(this,M,null);u(this,k,5e3)}async support(){const t=window.OfflineAudioContext||window.webkitOfflineAudioContext;return t?(d(this,S,new t(1,e(this,k),44100)),e(this,S)!==null):!1}async data(){if(e(this,S)===null)return null;const t=await K(this,x,at).call(this,e(this,S));return t===null?null:(d(this,M,t.toString()),{fingerprint:await n(e(this,M)),info:{audio:t}})}}S=new WeakMap,M=new WeakMap,k=new WeakMap,x=new WeakSet,at=function(t){return new Promise(l=>{const a=t.createOscillator();a.type="triangle",a.frequency.value=1e4;const p=t.createDynamicsCompressor();p.threshold.value=-50,p.knee.value=40,p.ratio.value=12,p.attack.value=0,p.release.value=.2,a.connect(p),p.connect(t.destination),a.start(),t.oncomplete=r=>{const b=r.renderedBuffer.getChannelData(0),R=K(this,x,it).call(this,b);l(R)},t.startRendering()})},it=function(t){let l=0;for(let a=0;a<t.length;++a)l+=Math.abs(t[a]);return l};class ot{constructor(){f(this,"name","Canvas Feature");f(this,"enabled",!0);u(this,g,null);u(this,A,null)}async support(){return document?(d(this,g,document.createElement("canvas").getContext("2d")),e(this,g)!==null):!1}async data(){return e(this,g)===null?null:(e(this,g).textBaseline="top",e(this,g).font="14px 'Arial'",e(this,g).textBaseline="alphabetic",e(this,g).fillStyle="#f60",e(this,g).fillRect(100,1,55,20),e(this,g).fillStyle="#069",e(this,g).fillText("Cyber Universe Canvas",2,15),e(this,g).fillStyle="rgba(102, 204, 0, 0.7)",e(this,g).fillText("Cyber Universe Canvas",4,17),d(this,A,e(this,g).canvas.toDataURL()),{fingerprint:await n(e(this,A)),info:{image:e(this,A)}})}}g=new WeakMap,A=new WeakMap;const q=class q{constructor(){f(this,"name","ColorGamut Feature");f(this,"enabled",!0);u(this,O,null);u(this,E,null)}async support(){return!0}async data(){for(const t of q.gamutList){const l=`(color-gamut: ${t})`;if(matchMedia(l).matches){d(this,O,`gamut: ${t}`),d(this,E,t);break}}return e(this,O)===null?null:{fingerprint:await n(e(this,O)),info:{colorGamut:e(this,E)}}}};O=new WeakMap,E=new WeakMap,f(q,"gamutList",["rec2020","p3","srgb"]);let Q=q;const N=class N{constructor(){f(this,"name","HDR Feature");f(this,"enabled",!0);u(this,T,null);u(this,U,null)}async support(){return!0}async data(){for(const t of N.hdrList){const l=`(dynamic-range: ${t})`;if(matchMedia(l).matches){d(this,T,`dynamic-range: ${t}`),d(this,U,t);break}}return e(this,T)===null?null:{fingerprint:await n(e(this,T)),info:{hdr:e(this,U)}}}};T=new WeakMap,U=new WeakMap,f(N,"hdrList",["high","standard"]);let G=N;class lt{constructor(){f(this,"name","Hardware Concurrency Feature");f(this,"enabled",!0);u(this,L,null);u(this,V,null);u(this,z,null)}async support(){return!!navigator}async data(){return navigator.hardwareConcurrency&&(d(this,L,navigator.hardwareConcurrency.toString()),d(this,z,navigator.hardwareConcurrency)),e(this,L)?(d(this,V,"hardware concurrency: "+e(this,L)),{fingerprint:await n(e(this,V)),info:{hardwareConcurrency:e(this,z)}}):null}}L=new WeakMap,V=new WeakMap,z=new WeakMap;class ut{constructor(){f(this,"name","Languages Feature");f(this,"enabled",!0);u(this,F,[]);u(this,$,null)}async support(){return!!navigator}async data(){var t;return navigator.language&&e(this,F).push([navigator.language]),Array.isArray(navigator.languages)&&e(this,F).push(navigator.languages),(t=e(this,F))!=null&&t.length?(d(this,$,JSON.stringify(e(this,F))),{fingerprint:await n(e(this,$)),info:{languages:e(this,$)}}):null}}F=new WeakMap,$=new WeakMap;class ct{constructor(){f(this,"name","Screen resolution Feature");f(this,"enabled",!0);u(this,y,null);u(this,j,null)}async support(){if(!(window.OfflineAudioContext||window.webkitOfflineAudioContext))return!1;const l=window.screen;return l?(d(this,y,l),e(this,y)!==null):!1}async data(){if(e(this,y)===null)return null;const t=`${e(this,y).width} x ${e(this,y).height}`;return d(this,j,t),{fingerprint:await n(e(this,j)),info:{screenResolution:t}}}}y=new WeakMap,j=new WeakMap;class ht{constructor(){u(this,H);f(this,"name","Timezone Feature");f(this,"enabled",!0);u(this,m,null)}async support(){return!0}async data(){if(Intl.DateTimeFormat){const t=new Intl.DateTimeFormat().resolvedOptions().timeZone;d(this,m,t)}else d(this,m,K(this,H,rt).call(this));return e(this,m)===null?null:{fingerprint:await n(e(this,m)),info:{timezone:e(this,m)}}}}m=new WeakMap,H=new WeakSet,rt=function(){const l=-new Date().getTimezoneOffset(),a=l>=0?"+":"-",p=Math.floor(Math.abs(l)/60).toString().padStart(2,"0"),r=(Math.abs(l)%60).toString().padStart(2,"0");return`UTC${a}${p}:${r}`};const ft=[new st,new ot,new Q,new G,new lt,new ut,new ct,new ht];async function dt(o){return o.enabled?await o.support()?await o.data():(console.log(`Feature ${o.name} is not supported`),null):(console.log(`Feature ${o.name} is disabled`),null)}async function gt(){var p;const o=[],t={},l={};for(const r of ft){const b=await dt(r);if(!b)continue;const R=r.name.toLowerCase().replace(/\s/g,"");t[R]={hash:b.fingerprint,value:JSON.stringify(b.info)},o.push(b.fingerprint)}const a=await I();if(a!=null&&a.ip){const r=await n(a.ip);l.client_ip={hash:r,value:a.ip},o.push(r)}return{id:await n(JSON.stringify(o)),ip:(a==null?void 0:a.ip)||!1,useragent:((p=a==null?void 0:a.headers)==null?void 0:p["user-agent"])??!1,headers:(a==null?void 0:a.headers)??!1,rawData:t,serverFeature:l}}i.collectFingerprint=gt,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
