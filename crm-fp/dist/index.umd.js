(function(r,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.CRMFingerprint={}))})(this,function(r){"use strict";var yt=Object.defineProperty;var it=r=>{throw TypeError(r)};var mt=(r,e,c)=>e in r?yt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[e]=c;var f=(r,e,c)=>mt(r,typeof e!="symbol"?e+"":e,c),tt=(r,e,c)=>e.has(r)||it("Cannot "+c);var n=(r,e,c)=>(tt(r,e,"read from private field"),c?c.call(r):e.get(r)),u=(r,e,c)=>e.has(r)?it("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,c),d=(r,e,c,_)=>(tt(r,e,"write to private field"),_?_.call(r,c):e.set(r,c),c),Q=(r,e,c)=>(tt(r,e,"access private method"),c);var x,L,j,A,at,rt,g,v,T,R,O,z,M,$,V,S,D,m,E,b,G,st;function e(s){function t(h,w){return h>>>w|h<<32-w}const l=new TextEncoder().encode(s),a=Array.from(l),p=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],Z=a.length*8;for(a.push(128);(a.length*8+64)%512!==0;)a.push(0);const H=new Array(8).fill(0);for(let h=0;h<8;h++)H[7-h]=Z>>>h*8&255;a.push(...H);const nt=[];for(let h=0;h<a.length;h+=64)nt.push(a.slice(h,h+64));return nt.forEach(h=>{const w=new Array(64);for(let o=0;o<16;o++)w[o]=h[o*4]<<24|h[o*4+1]<<16|h[o*4+2]<<8|h[o*4+3];for(let o=16;o<64;o++){const Y=t(w[o-15],7)^t(w[o-15],18)^w[o-15]>>>3,P=t(w[o-2],17)^t(w[o-2],19)^w[o-2]>>>10;w[o]=w[o-16]+Y+w[o-7]+P|0}let[C,I,U,W,F,J,N,X]=i;for(let o=0;o<64;o++){const Y=t(F,6)^t(F,11)^t(F,25),P=F&J^~F&N,et=X+Y+P+p[o]+w[o]|0,gt=t(C,2)^t(C,13)^t(C,22),pt=C&I^C&U^I&U,wt=gt+pt|0;X=N,N=J,J=F,F=W+et|0,W=U,U=I,I=C,C=et+wt|0}i[0]=i[0]+C|0,i[1]=i[1]+I|0,i[2]=i[2]+U|0,i[3]=i[3]+W|0,i[4]=i[4]+F|0,i[5]=i[5]+J|0,i[6]=i[6]+N|0,i[7]=i[7]+X|0}),i.map(h=>(h>>>0).toString(16).padStart(8,"0")).join("")}class c{constructor(){u(this,A);f(this,"name","Audio Feature");f(this,"enabled",!0);u(this,x,null);u(this,L,null);u(this,j,5e3)}async support(){const t=window.OfflineAudioContext||window.webkitOfflineAudioContext;return t?(d(this,x,new t(1,n(this,j),44100)),n(this,x)!==null):!1}async data(){if(n(this,x)===null)return null;const t=await Q(this,A,at).call(this,n(this,x));return t===null?null:(d(this,L,t.toString()),{fingerprint:await e(n(this,L)),info:{audio:t}})}}x=new WeakMap,L=new WeakMap,j=new WeakMap,A=new WeakSet,at=function(t){return new Promise(l=>{const a=t.createOscillator();a.type="triangle",a.frequency.value=1e4;const p=t.createDynamicsCompressor();p.threshold.value=-50,p.knee.value=40,p.ratio.value=12,p.attack.value=0,p.release.value=.2,a.connect(p),p.connect(t.destination),a.start(),t.oncomplete=i=>{const Z=i.renderedBuffer.getChannelData(0),H=Q(this,A,rt).call(this,Z);l(H)},t.startRendering()})},rt=function(t){let l=0;for(let a=0;a<t.length;++a)l+=Math.abs(t[a]);return l};class _{constructor(){f(this,"name","Canvas Feature");f(this,"enabled",!0);u(this,g,null);u(this,v,null)}async support(){return document?(d(this,g,document.createElement("canvas").getContext("2d")),n(this,g)!==null):!1}async data(){return n(this,g)===null?null:(n(this,g).textBaseline="top",n(this,g).font="14px 'Arial'",n(this,g).textBaseline="alphabetic",n(this,g).fillStyle="#f60",n(this,g).fillRect(100,1,55,20),n(this,g).fillStyle="#069",n(this,g).fillText("Cyber Universe Canvas",2,15),n(this,g).fillStyle="rgba(102, 204, 0, 0.7)",n(this,g).fillText("Cyber Universe Canvas",4,17),d(this,v,n(this,g).canvas.toDataURL()),{fingerprint:await e(n(this,v)),info:{image:n(this,v)}})}}g=new WeakMap,v=new WeakMap;const k=class k{constructor(){f(this,"name","ColorGamut Feature");f(this,"enabled",!0);u(this,T,null);u(this,R,null)}async support(){return!0}async data(){for(const t of k.gamutList){const l=`(color-gamut: ${t})`;if(matchMedia(l).matches){d(this,T,`gamut: ${t}`),d(this,R,t);break}}return n(this,T)===null?null:{fingerprint:await e(n(this,T)),info:{colorGamut:n(this,R)}}}};T=new WeakMap,R=new WeakMap,f(k,"gamutList",["rec2020","p3","srgb"]);let q=k;class ot{constructor(){f(this,"name","Hardware Concurrency Feature");f(this,"enabled",!0);u(this,O,null);u(this,z,null);u(this,M,null)}async support(){return!!navigator}async data(){return navigator.hardwareConcurrency&&(d(this,O,navigator.hardwareConcurrency.toString()),d(this,M,navigator.hardwareConcurrency)),n(this,O)?(d(this,z,"hardware concurrency: "+n(this,O)),{fingerprint:await e(n(this,z)),info:{hardwareConcurrency:n(this,M)}}):null}}O=new WeakMap,z=new WeakMap,M=new WeakMap;const B=class B{constructor(){f(this,"name","HDR Feature");f(this,"enabled",!0);u(this,$,null);u(this,V,null)}async support(){return!0}async data(){for(const t of B.hdrList){const l=`(dynamic-range: ${t})`;if(matchMedia(l).matches){d(this,$,`dynamic-range: ${t}`),d(this,V,t);break}}return n(this,$)===null?null:{fingerprint:await e(n(this,$)),info:{hdr:n(this,V)}}}};$=new WeakMap,V=new WeakMap,f(B,"hdrList",["high","standard"]);let K=B;class lt{constructor(){f(this,"name","Languages Feature");f(this,"enabled",!0);u(this,S,[]);u(this,D,null)}async support(){return!!navigator}async data(){var t;return navigator.language&&n(this,S).push([navigator.language]),Array.isArray(navigator.languages)&&n(this,S).push(navigator.languages),(t=n(this,S))!=null&&t.length?(d(this,D,JSON.stringify(n(this,S))),{fingerprint:await e(n(this,D)),info:{languages:n(this,D)}}):null}}S=new WeakMap,D=new WeakMap;class ut{constructor(){f(this,"name","Screen resolution Feature");f(this,"enabled",!0);u(this,m,null);u(this,E,null)}async support(){if(!(window.OfflineAudioContext||window.webkitOfflineAudioContext))return!1;const l=window.screen;return l?(d(this,m,l),n(this,m)!==null):!1}async data(){if(n(this,m)===null)return null;const t=`${n(this,m).width} x ${n(this,m).height}`;return d(this,E,t),{fingerprint:await e(n(this,E)),info:{screenResolution:t}}}}m=new WeakMap,E=new WeakMap;class ct{constructor(){u(this,G);f(this,"name","Timezone Feature");f(this,"enabled",!0);u(this,b,null)}async support(){return!0}async data(){if(Intl.DateTimeFormat){const t=new Intl.DateTimeFormat().resolvedOptions().timeZone;d(this,b,t)}else d(this,b,Q(this,G,st).call(this));return n(this,b)===null?null:{fingerprint:await e(n(this,b)),info:{timezone:n(this,b)}}}}b=new WeakMap,G=new WeakSet,st=function(){const l=-new Date().getTimezoneOffset(),a=l>=0?"+":"-",p=Math.floor(Math.abs(l)/60).toString().padStart(2,"0"),i=(Math.abs(l)%60).toString().padStart(2,"0");return`UTC${a}${p}:${i}`};const ht=async s=>s.enabled?await s.support()?await s.data():(console.log(`Feature ${s.name} is not supported`),null):(console.log(`Feature ${s.name} is disabled`),null),ft=async s=>await dt(s),dt=async s=>{const t=[new c,new _,new q,new K,new ot,new lt,new ut,new ct],l=[],a={};console.log("serverParams===",s);for(const p of t){const i=await ht(p);await y(a,i,"audio","audio"),await y(a,i,"canvas","image"),await y(a,i,"color gamut","colorGamut"),await y(a,i,"hdr","hdr"),await y(a,i,"hardware concurrency","hardwareConcurrency"),await y(a,i,"languages","languages"),await y(a,i,"screen resolution","screenResolution"),await y(a,i,"timezone","timezone"),s&&s!=null&&s.client_ip&&(await y(a,{fingerprint:e(s.client_ip),info:{client_ip:s.client_ip}},"client ip","client_ip"),l.push(s==null?void 0:s.client_ip)),l.push((i==null?void 0:i.fingerprint)||"")}return{id:await e(JSON.stringify(l)),useragent:navigator.userAgent,_rawData:a}},y=(s,t,l,a)=>{var p;(p=t==null?void 0:t.info)!=null&&p[a]&&(s[l]={hash:t.fingerprint,value:t.info[a]})};r.fpPromise=ft,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
