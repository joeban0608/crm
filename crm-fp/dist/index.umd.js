(function(i,t){typeof exports=="object"&&typeof module<"u"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(i=typeof globalThis<"u"?globalThis:i||self,t(i.CRMFingerprint={}))})(this,function(i){"use strict";var z=Object.defineProperty;var H=i=>{throw TypeError(i)};var Q=(i,t,l)=>t in i?z(i,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[t]=l;var O=(i,t,l)=>Q(i,typeof t!="symbol"?t+"":t,l),I=(i,t,l)=>t.has(i)||H("Cannot "+l);var a=(i,t,l)=>(I(i,t,"read from private field"),l?l.call(i):t.get(i)),y=(i,t,l)=>t.has(i)?H("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,l),T=(i,t,l,E)=>(I(i,t,"write to private field"),E?E.call(i,l):t.set(i,l),l),M=(i,t,l)=>(I(i,t,"access private method"),l);var m,C,R,v,N,$,f,b;function t(h){function n(r,c){return r>>>c|r<<32-c}const d=new TextEncoder().encode(h),u=Array.from(d),p=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],A=u.length*8;for(u.push(128);(u.length*8+64)%512!==0;)u.push(0);const w=new Array(8).fill(0);for(let r=0;r<8;r++)w[7-r]=A>>>r*8&255;u.push(...w);const x=[];for(let r=0;r<u.length;r+=64)x.push(u.slice(r,r+64));return x.forEach(r=>{const c=new Array(64);for(let s=0;s<16;s++)c[s]=r[s*4]<<24|r[s*4+1]<<16|r[s*4+2]<<8|r[s*4+3];for(let s=16;s<64;s++){const P=n(c[s-15],7)^n(c[s-15],18)^c[s-15]>>>3,U=n(c[s-2],17)^n(c[s-2],19)^c[s-2]>>>10;c[s]=c[s-16]+P+c[s-7]+U|0}let[e,F,S,D,g,j,B,L]=o;for(let s=0;s<64;s++){const P=n(g,6)^n(g,11)^n(g,25),U=g&j^~g&B,V=L+P+U+p[s]+c[s]|0,J=n(e,2)^n(e,13)^n(e,22),K=e&F^e&S^F&S,_=J+K|0;L=B,B=j,j=g,g=D+V|0,D=S,S=F,F=e,e=V+_|0}o[0]=o[0]+e|0,o[1]=o[1]+F|0,o[2]=o[2]+S|0,o[3]=o[3]+D|0,o[4]=o[4]+g|0,o[5]=o[5]+j|0,o[6]=o[6]+B|0,o[7]=o[7]+L|0}),o.map(r=>(r>>>0).toString(16).padStart(8,"0")).join("")}class l{constructor(){y(this,v);O(this,"name","Audio Feature");O(this,"enabled",!0);y(this,m,null);y(this,C,null);y(this,R,5e3)}async support(){const n=window.OfflineAudioContext||window.webkitOfflineAudioContext;return n?(T(this,m,new n(1,a(this,R),44100)),a(this,m)!==null):!1}async data(){if(a(this,m)===null)return null;const n=await M(this,v,N).call(this,a(this,m));return n===null?null:(T(this,C,await t(n.toString())),{fingerprint:a(this,C),info:{audio:n}})}}m=new WeakMap,C=new WeakMap,R=new WeakMap,v=new WeakSet,N=function(n){return new Promise(d=>{const u=n.createOscillator();u.type="triangle",u.frequency.value=1e4;const p=n.createDynamicsCompressor();p.threshold.value=-50,p.knee.value=40,p.ratio.value=12,p.attack.value=0,p.release.value=.2,u.connect(p),p.connect(n.destination),u.start(),n.oncomplete=o=>{const A=o.renderedBuffer.getChannelData(0),w=M(this,v,$).call(this,A);d(w)},n.startRendering()})},$=function(n){let d=0;for(let u=0;u<n.length;++u)d+=Math.abs(n[u]);return d};class E{constructor(){O(this,"name","Canvas Feature");O(this,"enabled",!0);y(this,f,null);y(this,b,null)}async support(){return document?(T(this,f,document.createElement("canvas").getContext("2d")),a(this,f)!==null):!1}async data(){return a(this,f)===null?null:(a(this,f).textBaseline="top",a(this,f).font="14px 'Arial'",a(this,f).textBaseline="alphabetic",a(this,f).fillStyle="#f60",a(this,f).fillRect(100,1,55,20),a(this,f).fillStyle="#069",a(this,f).fillText("Cyber Universe Canvas",2,15),a(this,f).fillStyle="rgba(102, 204, 0, 0.7)",a(this,f).fillText("Cyber Universe Canvas",4,17),T(this,b,a(this,f).canvas.toDataURL()),{fingerprint:await t(a(this,b)),info:{image:a(this,b)}})}}f=new WeakMap,b=new WeakMap;const k=async h=>h.enabled?await h.support()?await h.data():(console.log(`Feature ${h.name} is not supported`),null):(console.log(`Feature ${h.name} is disabled`),null),q=async()=>{const h=await G();return console.log("fpFeatureInfo",h),{useragent:navigator.userAgent,...h}},G=async()=>{var p,o,A,w,x,r;const h=[new E,new l];let n="",d="";const u=[];for(const c of h){const e=await k(c);console.log(c.name,e==null?void 0:e.fingerprint),console.log((p=e==null?void 0:e.info)==null?void 0:p.image),console.log((o=e==null?void 0:e.info)==null?void 0:o.audio),(A=e==null?void 0:e.info)!=null&&A.image&&(n=(w=e==null?void 0:e.info)==null?void 0:w.image),(x=e==null?void 0:e.info)!=null&&x.audio&&(d=(r=e==null?void 0:e.info)==null?void 0:r.audio),u.push((e==null?void 0:e.fingerprint)||"")}return{id:await t(JSON.stringify(u)),canvas:{hash:await t(n),text:n},audio:{hash:await t(d),value:d}}};i.fpPromise=q,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
