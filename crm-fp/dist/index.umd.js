(function(n,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.CRMFingerprint={}))})(this,function(n){"use strict";var et=Object.defineProperty;var q=n=>{throw TypeError(n)};var nt=(n,e,l)=>e in n?et(n,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[e]=l;var d=(n,e,l)=>nt(n,typeof e!="symbol"?e+"":e,l),G=(n,e,l)=>e.has(n)||q("Cannot "+l);var a=(n,e,l)=>(G(n,e,"read from private field"),l?l.call(n):e.get(n)),p=(n,e,l)=>e.has(n)?q("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,l),b=(n,e,l,R)=>(G(n,e,"write to private field"),R?R.call(n,l):e.set(n,l),l),H=(n,e,l)=>(G(n,e,"access private method"),l);var w,S,D,A,K,Q,c,F,v,x,C;function e(h){function t(u,g){return u>>>g|u<<32-g}const f=new TextEncoder().encode(h),s=Array.from(f),r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],U=s.length*8;for(s.push(128);(s.length*8+64)%512!==0;)s.push(0);const j=new Array(8).fill(0);for(let u=0;u<8;u++)j[7-u]=U>>>u*8&255;s.push(...j);const J=[];for(let u=0;u<s.length;u+=64)J.push(s.slice(u,u+64));return J.forEach(u=>{const g=new Array(64);for(let i=0;i<16;i++)g[i]=u[i*4]<<24|u[i*4+1]<<16|u[i*4+2]<<8|u[i*4+3];for(let i=16;i<64;i++){const $=t(g[i-15],7)^t(g[i-15],18)^g[i-15]>>>3,k=t(g[i-2],17)^t(g[i-2],19)^g[i-2]>>>10;g[i]=g[i-16]+$+g[i-7]+k|0}let[m,L,O,I,y,B,M,V]=o;for(let i=0;i<64;i++){const $=t(y,6)^t(y,11)^t(y,25),k=y&B^~y&M,N=V+$+k+r[i]+g[i]|0,Z=t(m,2)^t(m,13)^t(m,22),_=m&L^m&O^L&O,tt=Z+_|0;V=M,M=B,B=y,y=I+N|0,I=O,O=L,L=m,m=N+tt|0}o[0]=o[0]+m|0,o[1]=o[1]+L|0,o[2]=o[2]+O|0,o[3]=o[3]+I|0,o[4]=o[4]+y|0,o[5]=o[5]+B|0,o[6]=o[6]+M|0,o[7]=o[7]+V|0}),o.map(u=>(u>>>0).toString(16).padStart(8,"0")).join("")}class l{constructor(){p(this,A);d(this,"name","Audio Feature");d(this,"enabled",!0);p(this,w,null);p(this,S,null);p(this,D,5e3)}async support(){const t=window.OfflineAudioContext||window.webkitOfflineAudioContext;return t?(b(this,w,new t(1,a(this,D),44100)),a(this,w)!==null):!1}async data(){if(a(this,w)===null)return null;const t=await H(this,A,K).call(this,a(this,w));return t===null?null:(b(this,S,t.toString()),{fingerprint:await e(a(this,S)),info:{audio:t}})}}w=new WeakMap,S=new WeakMap,D=new WeakMap,A=new WeakSet,K=function(t){return new Promise(f=>{const s=t.createOscillator();s.type="triangle",s.frequency.value=1e4;const r=t.createDynamicsCompressor();r.threshold.value=-50,r.knee.value=40,r.ratio.value=12,r.attack.value=0,r.release.value=.2,s.connect(r),r.connect(t.destination),s.start(),t.oncomplete=o=>{const U=o.renderedBuffer.getChannelData(0),j=H(this,A,Q).call(this,U);f(j)},t.startRendering()})},Q=function(t){let f=0;for(let s=0;s<t.length;++s)f+=Math.abs(t[s]);return f};class R{constructor(){d(this,"name","Canvas Feature");d(this,"enabled",!0);p(this,c,null);p(this,F,null)}async support(){return document?(b(this,c,document.createElement("canvas").getContext("2d")),a(this,c)!==null):!1}async data(){return a(this,c)===null?null:(a(this,c).textBaseline="top",a(this,c).font="14px 'Arial'",a(this,c).textBaseline="alphabetic",a(this,c).fillStyle="#f60",a(this,c).fillRect(100,1,55,20),a(this,c).fillStyle="#069",a(this,c).fillText("Cyber Universe Canvas",2,15),a(this,c).fillStyle="rgba(102, 204, 0, 0.7)",a(this,c).fillText("Cyber Universe Canvas",4,17),b(this,F,a(this,c).canvas.toDataURL()),{fingerprint:await e(a(this,F)),info:{image:a(this,F)}})}}c=new WeakMap,F=new WeakMap;const E=class E{constructor(){d(this,"name","ColorGamut Feature");d(this,"enabled",!0);p(this,v,null)}async support(){return!0}async data(){for(const t of E.gamutList){const f=`(color-gamut: ${t})`;if(matchMedia(f).matches){b(this,v,t);break}}return a(this,v)===null?null:{fingerprint:await e(a(this,v)),info:{colorGamut:a(this,v)}}}};v=new WeakMap,d(E,"gamutList",["rec2020","p3","srgb"]);let P=E;class z{constructor(){d(this,"name","Languages Feature");d(this,"enabled",!0);p(this,x,[]);p(this,C,null)}async support(){return!!navigator}async data(){return navigator.language&&a(this,x).push([navigator.language]),Array.isArray(navigator.languages)&&a(this,x).push(navigator.languages),b(this,C,JSON.stringify(a(this,x))),{fingerprint:await e(a(this,C)),info:{languages:a(this,C)}}}}x=new WeakMap,C=new WeakMap;const W=async h=>h.enabled?await h.support()?await h.data():(console.log(`Feature ${h.name} is not supported`),null):(console.log(`Feature ${h.name} is disabled`),null),X=async()=>await Y(),Y=async()=>{const h=[new R,new l,new z,new P],t=[],f={};for(const s of h){const r=await W(s);T(f,r,"canvas","image"),T(f,r,"audio","audio"),T(f,r,"languages","languages"),T(f,r,"color gamut","colorGamut"),t.push((r==null?void 0:r.fingerprint)||"")}return{id:await e(JSON.stringify(t)),useragent:navigator.userAgent,rawData:f}},T=(h,t,f,s)=>{var r;(r=t==null?void 0:t.info)!=null&&r[s]&&(h[f]={hash:t.fingerprint,value:t.info[s]})};n.fpPromise=X,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
