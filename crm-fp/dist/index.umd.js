(function(a,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(a=typeof globalThis<"u"?globalThis:a||self,e(a.CRMFingerprint={}))})(this,function(a){"use strict";var rt=Object.defineProperty;var X=a=>{throw TypeError(a)};var ot=(a,e,l)=>e in a?rt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[e]=l;var g=(a,e,l)=>ot(a,typeof e!="symbol"?e+"":e,l),H=(a,e,l)=>e.has(a)||X("Cannot "+l);var n=(a,e,l)=>(H(a,e,"read from private field"),l?l.call(a):e.get(a)),p=(a,e,l)=>e.has(a)?X("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,l),m=(a,e,l,E)=>(H(a,e,"write to private field"),E?E.call(a,l):e.set(a,l),l),K=(a,e,l)=>(H(a,e,"access private method"),l);var v,O,M,b,Y,Z,h,A,x,R,C,D,F,S;function e(f){function t(c,d){return c>>>d|c<<32-d}const u=new TextEncoder().encode(f),s=Array.from(u),r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],G=s.length*8;for(s.push(128);(s.length*8+64)%512!==0;)s.push(0);const B=new Array(8).fill(0);for(let c=0;c<8;c++)B[7-c]=G>>>c*8&255;s.push(...B);const z=[];for(let c=0;c<s.length;c+=64)z.push(s.slice(c,c+64));return z.forEach(c=>{const d=new Array(64);for(let i=0;i<16;i++)d[i]=c[i*4]<<24|c[i*4+1]<<16|c[i*4+2]<<8|c[i*4+3];for(let i=16;i<64;i++){const Q=t(d[i-15],7)^t(d[i-15],18)^d[i-15]>>>3,q=t(d[i-2],17)^t(d[i-2],19)^d[i-2]>>>10;d[i]=d[i-16]+Q+d[i-7]+q|0}let[y,T,$,J,w,P,U,N]=o;for(let i=0;i<64;i++){const Q=t(w,6)^t(w,11)^t(w,25),q=w&P^~w&U,W=N+Q+q+r[i]+d[i]|0,at=t(y,2)^t(y,13)^t(y,22),it=y&T^y&$^T&$,st=at+it|0;N=U,U=P,P=w,w=J+W|0,J=$,$=T,T=y,y=W+st|0}o[0]=o[0]+y|0,o[1]=o[1]+T|0,o[2]=o[2]+$|0,o[3]=o[3]+J|0,o[4]=o[4]+w|0,o[5]=o[5]+P|0,o[6]=o[6]+U|0,o[7]=o[7]+N|0}),o.map(c=>(c>>>0).toString(16).padStart(8,"0")).join("")}class l{constructor(){p(this,b);g(this,"name","Audio Feature");g(this,"enabled",!0);p(this,v,null);p(this,O,null);p(this,M,5e3)}async support(){const t=window.OfflineAudioContext||window.webkitOfflineAudioContext;return t?(m(this,v,new t(1,n(this,M),44100)),n(this,v)!==null):!1}async data(){if(n(this,v)===null)return null;const t=await K(this,b,Y).call(this,n(this,v));return t===null?null:(m(this,O,t.toString()),{fingerprint:await e(n(this,O)),info:{audio:t}})}}v=new WeakMap,O=new WeakMap,M=new WeakMap,b=new WeakSet,Y=function(t){return new Promise(u=>{const s=t.createOscillator();s.type="triangle",s.frequency.value=1e4;const r=t.createDynamicsCompressor();r.threshold.value=-50,r.knee.value=40,r.ratio.value=12,r.attack.value=0,r.release.value=.2,s.connect(r),r.connect(t.destination),s.start(),t.oncomplete=o=>{const G=o.renderedBuffer.getChannelData(0),B=K(this,b,Z).call(this,G);u(B)},t.startRendering()})},Z=function(t){let u=0;for(let s=0;s<t.length;++s)u+=Math.abs(t[s]);return u};class E{constructor(){g(this,"name","Canvas Feature");g(this,"enabled",!0);p(this,h,null);p(this,A,null)}async support(){return document?(m(this,h,document.createElement("canvas").getContext("2d")),n(this,h)!==null):!1}async data(){return n(this,h)===null?null:(n(this,h).textBaseline="top",n(this,h).font="14px 'Arial'",n(this,h).textBaseline="alphabetic",n(this,h).fillStyle="#f60",n(this,h).fillRect(100,1,55,20),n(this,h).fillStyle="#069",n(this,h).fillText("Cyber Universe Canvas",2,15),n(this,h).fillStyle="rgba(102, 204, 0, 0.7)",n(this,h).fillText("Cyber Universe Canvas",4,17),m(this,A,n(this,h).canvas.toDataURL()),{fingerprint:await e(n(this,A)),info:{image:n(this,A)}})}}h=new WeakMap,A=new WeakMap;const V=class V{constructor(){g(this,"name","ColorGamut Feature");g(this,"enabled",!0);p(this,x,null);p(this,R,null)}async support(){return!0}async data(){for(const t of V.gamutList){const u=`(color-gamut: ${t})`;if(matchMedia(u).matches){m(this,x,`gamut: ${t}`),m(this,R,t);break}}return n(this,x)===null?null:{fingerprint:await e(n(this,x)),info:{colorGamut:n(this,R)}}}};x=new WeakMap,R=new WeakMap,g(V,"gamutList",["rec2020","p3","srgb"]);let k=V;const j=class j{constructor(){g(this,"name","HDR Feature");g(this,"enabled",!0);p(this,C,null);p(this,D,null)}async support(){return!0}async data(){for(const t of j.hdrList){const u=`(dynamic-range: ${t})`;if(matchMedia(u).matches){m(this,C,`dynamic-range: ${t}`),m(this,D,t);break}}return n(this,C)===null?null:{fingerprint:await e(n(this,C)),info:{hdr:n(this,D)}}}};C=new WeakMap,D=new WeakMap,g(j,"hdrList",["high","standard"]);let I=j;class _{constructor(){g(this,"name","Languages Feature");g(this,"enabled",!0);p(this,F,[]);p(this,S,null)}async support(){return!!navigator}async data(){return navigator.language&&n(this,F).push([navigator.language]),Array.isArray(navigator.languages)&&n(this,F).push(navigator.languages),m(this,S,JSON.stringify(n(this,F))),{fingerprint:await e(n(this,S)),info:{languages:n(this,S)}}}}F=new WeakMap,S=new WeakMap;const tt=async f=>f.enabled?await f.support()?await f.data():(console.log(`Feature ${f.name} is not supported`),null):(console.log(`Feature ${f.name} is disabled`),null),et=async()=>await nt(),nt=async()=>{const f=[new E,new l,new _,new k,new I],t=[],u={};for(const s of f){const r=await tt(s);L(u,r,"canvas","image"),L(u,r,"audio","audio"),L(u,r,"languages","languages"),L(u,r,"color gamut","colorGamut"),L(u,r,"hdr","hdr"),t.push((r==null?void 0:r.fingerprint)||"")}return{id:await e(JSON.stringify(t)),useragent:navigator.userAgent,rawData:u}},L=(f,t,u,s)=>{var r;(r=t==null?void 0:t.info)!=null&&r[s]&&(f[u]={hash:t.fingerprint,value:t.info[s]})};a.fpPromise=et,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
