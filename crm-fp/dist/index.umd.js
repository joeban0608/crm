(function(a,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(a=typeof globalThis<"u"?globalThis:a||self,e(a.CRMFingerprint={}))})(this,function(a){"use strict";var ct=Object.defineProperty;var _=a=>{throw TypeError(a)};var ht=(a,e,u)=>e in a?ct(a,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[e]=u;var g=(a,e,u)=>ht(a,typeof e!="symbol"?e+"":e,u),W=(a,e,u)=>e.has(a)||_("Cannot "+u);var n=(a,e,u)=>(W(a,e,"read from private field"),u?u.call(a):e.get(a)),d=(a,e,u)=>e.has(a)?_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,u),y=(a,e,u,j)=>(W(a,e,"write to private field"),j?j.call(a,u):e.set(a,u),u),X=(a,e,u)=>(W(a,e,"access private method"),u);var v,R,B,A,tt,nt,h,F,x,D,S,T,V,L,$,b,O;function e(f){function t(c,p){return c>>>p|c<<32-p}const o=new TextEncoder().encode(f),s=Array.from(o),i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],l=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],N=s.length*8;for(s.push(128);(s.length*8+64)%512!==0;)s.push(0);const k=new Array(8).fill(0);for(let c=0;c<8;c++)k[7-c]=N>>>c*8&255;s.push(...k);const Y=[];for(let c=0;c<s.length;c+=64)Y.push(s.slice(c,c+64));return Y.forEach(c=>{const p=new Array(64);for(let r=0;r<16;r++)p[r]=c[r*4]<<24|c[r*4+1]<<16|c[r*4+2]<<8|c[r*4+3];for(let r=16;r<64;r++){const K=t(p[r-15],7)^t(p[r-15],18)^p[r-15]>>>3,z=t(p[r-2],17)^t(p[r-2],19)^p[r-2]>>>10;p[r]=p[r-16]+K+p[r-7]+z|0}let[m,E,M,Q,w,H,I,q]=l;for(let r=0;r<64;r++){const K=t(w,6)^t(w,11)^t(w,25),z=w&H^~w&I,Z=q+K+z+i[r]+p[r]|0,ot=t(m,2)^t(m,13)^t(m,22),lt=m&E^m&M^E&M,ut=ot+lt|0;q=I,I=H,H=w,w=Q+Z|0,Q=M,M=E,E=m,m=Z+ut|0}l[0]=l[0]+m|0,l[1]=l[1]+E|0,l[2]=l[2]+M|0,l[3]=l[3]+Q|0,l[4]=l[4]+w|0,l[5]=l[5]+H|0,l[6]=l[6]+I|0,l[7]=l[7]+q|0}),l.map(c=>(c>>>0).toString(16).padStart(8,"0")).join("")}class u{constructor(){d(this,A);g(this,"name","Audio Feature");g(this,"enabled",!0);d(this,v,null);d(this,R,null);d(this,B,5e3)}async support(){const t=window.OfflineAudioContext||window.webkitOfflineAudioContext;return t?(y(this,v,new t(1,n(this,B),44100)),n(this,v)!==null):!1}async data(){if(n(this,v)===null)return null;const t=await X(this,A,tt).call(this,n(this,v));return t===null?null:(y(this,R,t.toString()),{fingerprint:await e(n(this,R)),info:{audio:t}})}}v=new WeakMap,R=new WeakMap,B=new WeakMap,A=new WeakSet,tt=function(t){return new Promise(o=>{const s=t.createOscillator();s.type="triangle",s.frequency.value=1e4;const i=t.createDynamicsCompressor();i.threshold.value=-50,i.knee.value=40,i.ratio.value=12,i.attack.value=0,i.release.value=.2,s.connect(i),i.connect(t.destination),s.start(),t.oncomplete=l=>{const N=l.renderedBuffer.getChannelData(0),k=X(this,A,nt).call(this,N);o(k)},t.startRendering()})},nt=function(t){let o=0;for(let s=0;s<t.length;++s)o+=Math.abs(t[s]);return o};class j{constructor(){g(this,"name","Canvas Feature");g(this,"enabled",!0);d(this,h,null);d(this,F,null)}async support(){return document?(y(this,h,document.createElement("canvas").getContext("2d")),n(this,h)!==null):!1}async data(){return n(this,h)===null?null:(n(this,h).textBaseline="top",n(this,h).font="14px 'Arial'",n(this,h).textBaseline="alphabetic",n(this,h).fillStyle="#f60",n(this,h).fillRect(100,1,55,20),n(this,h).fillStyle="#069",n(this,h).fillText("Cyber Universe Canvas",2,15),n(this,h).fillStyle="rgba(102, 204, 0, 0.7)",n(this,h).fillText("Cyber Universe Canvas",4,17),y(this,F,n(this,h).canvas.toDataURL()),{fingerprint:await e(n(this,F)),info:{image:n(this,F)}})}}h=new WeakMap,F=new WeakMap;const P=class P{constructor(){g(this,"name","ColorGamut Feature");g(this,"enabled",!0);d(this,x,null);d(this,D,null)}async support(){return!0}async data(){for(const t of P.gamutList){const o=`(color-gamut: ${t})`;if(matchMedia(o).matches){y(this,x,`gamut: ${t}`),y(this,D,t);break}}return n(this,x)===null?null:{fingerprint:await e(n(this,x)),info:{colorGamut:n(this,D)}}}};x=new WeakMap,D=new WeakMap,g(P,"gamutList",["rec2020","p3","srgb"]);let G=P;class et{constructor(){g(this,"name","Hardware Concurrency Feature");g(this,"enabled",!0);d(this,S,null);d(this,T,null);d(this,V,null)}async support(){return!!navigator}async data(){return navigator.hardwareConcurrency&&(y(this,S,navigator.hardwareConcurrency.toString()),y(this,V,navigator.hardwareConcurrency)),n(this,S)?(y(this,T,"hardware concurrency: "+n(this,S)),{fingerprint:await e(n(this,T)),info:{hardwareConcurrency:n(this,V)}}):null}}S=new WeakMap,T=new WeakMap,V=new WeakMap;const U=class U{constructor(){g(this,"name","HDR Feature");g(this,"enabled",!0);d(this,L,null);d(this,$,null)}async support(){return!0}async data(){for(const t of U.hdrList){const o=`(dynamic-range: ${t})`;if(matchMedia(o).matches){y(this,L,`dynamic-range: ${t}`),y(this,$,t);break}}return n(this,L)===null?null:{fingerprint:await e(n(this,L)),info:{hdr:n(this,$)}}}};L=new WeakMap,$=new WeakMap,g(U,"hdrList",["high","standard"]);let J=U;class at{constructor(){g(this,"name","Languages Feature");g(this,"enabled",!0);d(this,b,[]);d(this,O,null)}async support(){return!!navigator}async data(){var t;return navigator.language&&n(this,b).push([navigator.language]),Array.isArray(navigator.languages)&&n(this,b).push(navigator.languages),(t=n(this,b))!=null&&t.length?(y(this,O,JSON.stringify(n(this,b))),{fingerprint:await e(n(this,O)),info:{languages:n(this,O)}}):null}}b=new WeakMap,O=new WeakMap;const rt=async f=>f.enabled?await f.support()?await f.data():(console.log(`Feature ${f.name} is not supported`),null):(console.log(`Feature ${f.name} is disabled`),null),it=async()=>await st(),st=async()=>{const f=[new u,new j,new G,new J,new et,new at],t=[],o={};for(const s of f){const i=await rt(s);C(o,i,"audio","audio"),C(o,i,"canvas","image"),C(o,i,"color gamut","colorGamut"),C(o,i,"hdr","hdr"),C(o,i,"hardware concurrency","hardwareConcurrency"),C(o,i,"languages","languages"),t.push((i==null?void 0:i.fingerprint)||"")}return{id:await e(JSON.stringify(t)),useragent:navigator.userAgent,rawData:o}},C=(f,t,o,s)=>{var i;(i=t==null?void 0:t.info)!=null&&i[s]&&(f[o]={hash:t.fingerprint,value:t.info[s]})};a.fpPromise=it,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
