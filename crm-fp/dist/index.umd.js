(function(i,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(i=typeof globalThis<"u"?globalThis:i||self,a(i.CRMFingerprint={}))})(this,function(i){"use strict";var yt=Object.defineProperty;var at=i=>{throw TypeError(i)};var bt=(i,a,h)=>a in i?yt(i,a,{enumerable:!0,configurable:!0,writable:!0,value:h}):i[a]=h;var d=(i,a,h)=>bt(i,typeof a!="symbol"?a+"":a,h),tt=(i,a,h)=>a.has(i)||at("Cannot "+h);var e=(i,a,h)=>(tt(i,a,"read from private field"),h?h.call(i):a.get(i)),c=(i,a,h)=>a.has(i)?at("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(i):a.set(i,h),g=(i,a,h,U)=>(tt(i,a,"write to private field"),U?U.call(i,h):a.set(i,h),h),Q=(i,a,h)=>(tt(i,a,"access private method"),h);var S,L,B,A,it,rt,p,T,D,z,O,M,V,R,j,x,$,b,k,v,G,st;function a(o){function t(f,m){return f>>>m|f<<32-m}const r=new TextEncoder().encode(o),n=Array.from(r),l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],w=n.length*8;for(n.push(128);(n.length*8+64)%512!==0;)n.push(0);const H=new Array(8).fill(0);for(let f=0;f<8;f++)H[7-f]=w>>>f*8&255;n.push(...H);const et=[];for(let f=0;f<n.length;f+=64)et.push(n.slice(f,f+64));return et.forEach(f=>{const m=new Array(64);for(let u=0;u<16;u++)m[u]=f[u*4]<<24|f[u*4+1]<<16|f[u*4+2]<<8|f[u*4+3];for(let u=16;u<64;u++){const X=t(m[u-15],7)^t(m[u-15],18)^m[u-15]>>>3,Y=t(m[u-2],17)^t(m[u-2],19)^m[u-2]>>>10;m[u]=m[u-16]+X+m[u-7]+Y|0}let[C,E,I,Z,F,J,N,W]=s;for(let u=0;u<64;u++){const X=t(F,6)^t(F,11)^t(F,25),Y=F&J^~F&N,nt=W+X+Y+l[u]+m[u]|0,pt=t(C,2)^t(C,13)^t(C,22),wt=C&E^C&I^E&I,mt=pt+wt|0;W=N,N=J,J=F,F=Z+nt|0,Z=I,I=E,E=C,C=nt+mt|0}s[0]=s[0]+C|0,s[1]=s[1]+E|0,s[2]=s[2]+I|0,s[3]=s[3]+Z|0,s[4]=s[4]+F|0,s[5]=s[5]+J|0,s[6]=s[6]+N|0,s[7]=s[7]+W|0}),s.map(f=>(f>>>0).toString(16).padStart(8,"0")).join("")}class h{constructor(){c(this,A);d(this,"name","Audio Feature");d(this,"enabled",!0);c(this,S,null);c(this,L,null);c(this,B,5e3)}async support(){const t=window.OfflineAudioContext||window.webkitOfflineAudioContext;return t?(g(this,S,new t(1,e(this,B),44100)),e(this,S)!==null):!1}async data(){if(e(this,S)===null)return null;const t=await Q(this,A,it).call(this,e(this,S));return t===null?null:(g(this,L,t.toString()),{fingerprint:await a(e(this,L)),info:{audio:t}})}}S=new WeakMap,L=new WeakMap,B=new WeakMap,A=new WeakSet,it=function(t){return new Promise(r=>{const n=t.createOscillator();n.type="triangle",n.frequency.value=1e4;const l=t.createDynamicsCompressor();l.threshold.value=-50,l.knee.value=40,l.ratio.value=12,l.attack.value=0,l.release.value=.2,n.connect(l),l.connect(t.destination),n.start(),t.oncomplete=s=>{const w=s.renderedBuffer.getChannelData(0),H=Q(this,A,rt).call(this,w);r(H)},t.startRendering()})},rt=function(t){let r=0;for(let n=0;n<t.length;++n)r+=Math.abs(t[n]);return r};class U{constructor(){d(this,"name","Canvas Feature");d(this,"enabled",!0);c(this,p,null);c(this,T,null)}async support(){return document?(g(this,p,document.createElement("canvas").getContext("2d")),e(this,p)!==null):!1}async data(){return e(this,p)===null?null:(e(this,p).textBaseline="top",e(this,p).font="14px 'Arial'",e(this,p).textBaseline="alphabetic",e(this,p).fillStyle="#f60",e(this,p).fillRect(100,1,55,20),e(this,p).fillStyle="#069",e(this,p).fillText("Cyber Universe Canvas",2,15),e(this,p).fillStyle="rgba(102, 204, 0, 0.7)",e(this,p).fillText("Cyber Universe Canvas",4,17),g(this,T,e(this,p).canvas.toDataURL()),{fingerprint:await a(e(this,T)),info:{image:e(this,T)}})}}p=new WeakMap,T=new WeakMap;const P=class P{constructor(){d(this,"name","ColorGamut Feature");d(this,"enabled",!0);c(this,D,null);c(this,z,null)}async support(){return!0}async data(){for(const t of P.gamutList){const r=`(color-gamut: ${t})`;if(matchMedia(r).matches){g(this,D,`gamut: ${t}`),g(this,z,t);break}}return e(this,D)===null?null:{fingerprint:await a(e(this,D)),info:{colorGamut:e(this,z)}}}};D=new WeakMap,z=new WeakMap,d(P,"gamutList",["rec2020","p3","srgb"]);let q=P;class ot{constructor(){d(this,"name","Hardware Concurrency Feature");d(this,"enabled",!0);c(this,O,null);c(this,M,null);c(this,V,null)}async support(){return!!navigator}async data(){return navigator.hardwareConcurrency&&(g(this,O,navigator.hardwareConcurrency.toString()),g(this,V,navigator.hardwareConcurrency)),e(this,O)?(g(this,M,"hardware concurrency: "+e(this,O)),{fingerprint:await a(e(this,M)),info:{hardwareConcurrency:e(this,V)}}):null}}O=new WeakMap,M=new WeakMap,V=new WeakMap;const _=class _{constructor(){d(this,"name","HDR Feature");d(this,"enabled",!0);c(this,R,null);c(this,j,null)}async support(){return!0}async data(){for(const t of _.hdrList){const r=`(dynamic-range: ${t})`;if(matchMedia(r).matches){g(this,R,`dynamic-range: ${t}`),g(this,j,t);break}}return e(this,R)===null?null:{fingerprint:await a(e(this,R)),info:{hdr:e(this,j)}}}};R=new WeakMap,j=new WeakMap,d(_,"hdrList",["high","standard"]);let K=_;class ut{constructor(){d(this,"name","Languages Feature");d(this,"enabled",!0);c(this,x,[]);c(this,$,null)}async support(){return!!navigator}async data(){var t;return navigator.language&&e(this,x).push([navigator.language]),Array.isArray(navigator.languages)&&e(this,x).push(navigator.languages),(t=e(this,x))!=null&&t.length?(g(this,$,JSON.stringify(e(this,x))),{fingerprint:await a(e(this,$)),info:{languages:e(this,$)}}):null}}x=new WeakMap,$=new WeakMap;class lt{constructor(){d(this,"name","Screen resolution Feature");d(this,"enabled",!0);c(this,b,null);c(this,k,null)}async support(){if(!(window.OfflineAudioContext||window.webkitOfflineAudioContext))return!1;const r=window.screen;return r?(g(this,b,r),e(this,b)!==null):!1}async data(){if(e(this,b)===null)return null;const t=`${e(this,b).width} x ${e(this,b).height}`;return g(this,k,t),{fingerprint:await a(e(this,k)),info:{screenResolution:t}}}}b=new WeakMap,k=new WeakMap;class ct{constructor(){c(this,G);d(this,"name","Timezone Feature");d(this,"enabled",!0);c(this,v,null)}async support(){return!0}async data(){if(Intl.DateTimeFormat){const t=new Intl.DateTimeFormat().resolvedOptions().timeZone;g(this,v,t)}else g(this,v,Q(this,G,st).call(this));return e(this,v)===null?null:{fingerprint:await a(e(this,v)),info:{timezone:e(this,v)}}}}v=new WeakMap,G=new WeakSet,st=function(){const r=-new Date().getTimezoneOffset(),n=r>=0?"+":"-",l=Math.floor(Math.abs(r)/60).toString().padStart(2,"0"),s=(Math.abs(r)%60).toString().padStart(2,"0");return`UTC${n}${l}:${s}`};const ht=async o=>o.enabled?await o.support()?await o.data():(console.log(`Feature ${o.name} is not supported`),null):(console.log(`Feature ${o.name} is disabled`),null),ft=async o=>await dt(o),dt=async o=>{const t=[new h,new U,new q,new K,new ot,new ut,new lt,new ct],r=[],n={},l={};for(const s of t){const w=await ht(s);await y(w,"audio","audio",n),await y(w,"canvas","image",n),await y(w,"color gamut","colorGamut",n),await y(w,"hdr","hdr",n),await y(w,"hardware concurrency","hardwareConcurrency",n),await y(w,"languages","languages",n),await y(w,"screen resolution","screenResolution",n),await y(w,"timezone","timezone",n),r.push((w==null?void 0:w.fingerprint)||"")}return await gt(l,r,o),{id:await a(JSON.stringify(r)),useragent:navigator.userAgent,rawData:n,serverData:l}},y=(o,t,r,n)=>{var l;(l=o==null?void 0:o.info)!=null&&l[r]&&(n[t]={hash:o.fingerprint,value:o.info[r]})},gt=(o,t,r)=>{if(r)for(const n in r){const l={fingerprint:a(r[n]),info:{[n]:r[n]}},s=n.includes("_")?n.split("_").join(" "):n.includes("-")?n.split("-").join(" "):n;y(l,s,n,o),t.push(l.fingerprint)}};i.fpPromise=ft,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
