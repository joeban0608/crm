(function(r,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(r=typeof globalThis<"u"?globalThis:r||self,n(r.CRMFingerprint={}))})(this,function(r){"use strict";var Ct=Object.defineProperty;var at=r=>{throw TypeError(r)};var Ft=(r,n,h)=>n in r?Ct(r,n,{enumerable:!0,configurable:!0,writable:!0,value:h}):r[n]=h;var d=(r,n,h)=>Ft(r,typeof n!="symbol"?n+"":n,h),tt=(r,n,h)=>n.has(r)||at("Cannot "+h);var e=(r,n,h)=>(tt(r,n,"read from private field"),h?h.call(r):n.get(r)),c=(r,n,h)=>n.has(r)?at("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(r):n.set(r,h),g=(r,n,h,k)=>(tt(r,n,"write to private field"),k?k.call(r,h):n.set(r,h),h),Q=(r,n,h)=>(tt(r,n,"access private method"),h);var v,z,q,A,it,rt,p,T,O,M,R,V,j,$,E,x,L,b,U,C,N,st;function n(i){function t(f,y){return f>>>y|f<<32-y}const a=new TextEncoder().encode(i),s=Array.from(a),o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],u=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],w=s.length*8;for(s.push(128);(s.length*8+64)%512!==0;)s.push(0);const D=new Array(8).fill(0);for(let f=0;f<8;f++)D[7-f]=w>>>f*8&255;s.push(...D);const et=[];for(let f=0;f<s.length;f+=64)et.push(s.slice(f,f+64));return et.forEach(f=>{const y=new Array(64);for(let l=0;l<16;l++)y[l]=f[l*4]<<24|f[l*4+1]<<16|f[l*4+2]<<8|f[l*4+3];for(let l=16;l<64;l++){const X=t(y[l-15],7)^t(y[l-15],18)^y[l-15]>>>3,Y=t(y[l-2],17)^t(y[l-2],19)^y[l-2]>>>10;y[l]=y[l-16]+X+y[l-7]+Y|0}let[F,I,P,_,S,G,H,W]=u;for(let l=0;l<64;l++){const X=t(S,6)^t(S,11)^t(S,25),Y=S&G^~S&H,nt=W+X+Y+o[l]+y[l]|0,yt=t(F,2)^t(F,13)^t(F,22),mt=F&I^F&P^I&P,bt=yt+mt|0;W=H,H=G,G=S,S=_+nt|0,_=P,P=I,I=F,F=nt+bt|0}u[0]=u[0]+F|0,u[1]=u[1]+I|0,u[2]=u[2]+P|0,u[3]=u[3]+_|0,u[4]=u[4]+S|0,u[5]=u[5]+G|0,u[6]=u[6]+H|0,u[7]=u[7]+W|0}),u.map(f=>(f>>>0).toString(16).padStart(8,"0")).join("")}class h{constructor(){c(this,A);d(this,"name","Audio Feature");d(this,"enabled",!0);c(this,v,null);c(this,z,null);c(this,q,5e3)}async support(){const t=window.OfflineAudioContext||window.webkitOfflineAudioContext;return t?(g(this,v,new t(1,e(this,q),44100)),e(this,v)!==null):!1}async data(){if(e(this,v)===null)return null;const t=await Q(this,A,it).call(this,e(this,v));return t===null?null:(g(this,z,t.toString()),{fingerprint:await n(e(this,z)),info:{audio:t}})}}v=new WeakMap,z=new WeakMap,q=new WeakMap,A=new WeakSet,it=function(t){return new Promise(a=>{const s=t.createOscillator();s.type="triangle",s.frequency.value=1e4;const o=t.createDynamicsCompressor();o.threshold.value=-50,o.knee.value=40,o.ratio.value=12,o.attack.value=0,o.release.value=.2,s.connect(o),o.connect(t.destination),s.start(),t.oncomplete=u=>{const w=u.renderedBuffer.getChannelData(0),D=Q(this,A,rt).call(this,w);a(D)},t.startRendering()})},rt=function(t){let a=0;for(let s=0;s<t.length;++s)a+=Math.abs(t[s]);return a};class k{constructor(){d(this,"name","Canvas Feature");d(this,"enabled",!0);c(this,p,null);c(this,T,null)}async support(){return document?(g(this,p,document.createElement("canvas").getContext("2d")),e(this,p)!==null):!1}async data(){return e(this,p)===null?null:(e(this,p).textBaseline="top",e(this,p).font="14px 'Arial'",e(this,p).textBaseline="alphabetic",e(this,p).fillStyle="#f60",e(this,p).fillRect(100,1,55,20),e(this,p).fillStyle="#069",e(this,p).fillText("Cyber Universe Canvas",2,15),e(this,p).fillStyle="rgba(102, 204, 0, 0.7)",e(this,p).fillText("Cyber Universe Canvas",4,17),g(this,T,e(this,p).canvas.toDataURL()),{fingerprint:await n(e(this,T)),info:{image:e(this,T)}})}}p=new WeakMap,T=new WeakMap;const B=class B{constructor(){d(this,"name","ColorGamut Feature");d(this,"enabled",!0);c(this,O,null);c(this,M,null)}async support(){return!0}async data(){for(const t of B.gamutList){const a=`(color-gamut: ${t})`;if(matchMedia(a).matches){g(this,O,`gamut: ${t}`),g(this,M,t);break}}return e(this,O)===null?null:{fingerprint:await n(e(this,O)),info:{colorGamut:e(this,M)}}}};O=new WeakMap,M=new WeakMap,d(B,"gamutList",["rec2020","p3","srgb"]);let K=B;class ot{constructor(){d(this,"name","Hardware Concurrency Feature");d(this,"enabled",!0);c(this,R,null);c(this,V,null);c(this,j,null)}async support(){return!!navigator}async data(){return navigator.hardwareConcurrency&&(g(this,R,navigator.hardwareConcurrency.toString()),g(this,j,navigator.hardwareConcurrency)),e(this,R)?(g(this,V,"hardware concurrency: "+e(this,R)),{fingerprint:await n(e(this,V)),info:{hardwareConcurrency:e(this,j)}}):null}}R=new WeakMap,V=new WeakMap,j=new WeakMap;const J=class J{constructor(){d(this,"name","HDR Feature");d(this,"enabled",!0);c(this,$,null);c(this,E,null)}async support(){return!0}async data(){for(const t of J.hdrList){const a=`(dynamic-range: ${t})`;if(matchMedia(a).matches){g(this,$,`dynamic-range: ${t}`),g(this,E,t);break}}return e(this,$)===null?null:{fingerprint:await n(e(this,$)),info:{hdr:e(this,E)}}}};$=new WeakMap,E=new WeakMap,d(J,"hdrList",["high","standard"]);let Z=J;class ut{constructor(){d(this,"name","Languages Feature");d(this,"enabled",!0);c(this,x,[]);c(this,L,null)}async support(){return!!navigator}async data(){var t;return navigator.language&&e(this,x).push([navigator.language]),Array.isArray(navigator.languages)&&e(this,x).push(navigator.languages),(t=e(this,x))!=null&&t.length?(g(this,L,JSON.stringify(e(this,x))),{fingerprint:await n(e(this,L)),info:{languages:e(this,L)}}):null}}x=new WeakMap,L=new WeakMap;class lt{constructor(){d(this,"name","Screen resolution Feature");d(this,"enabled",!0);c(this,b,null);c(this,U,null)}async support(){if(!(window.OfflineAudioContext||window.webkitOfflineAudioContext))return!1;const a=window.screen;return a?(g(this,b,a),e(this,b)!==null):!1}async data(){if(e(this,b)===null)return null;const t=`${e(this,b).width} x ${e(this,b).height}`;return g(this,U,t),{fingerprint:await n(e(this,U)),info:{screenResolution:t}}}}b=new WeakMap,U=new WeakMap;class ct{constructor(){c(this,N);d(this,"name","Timezone Feature");d(this,"enabled",!0);c(this,C,null)}async support(){return!0}async data(){if(Intl.DateTimeFormat){const t=new Intl.DateTimeFormat().resolvedOptions().timeZone;g(this,C,t)}else g(this,C,Q(this,N,st).call(this));return e(this,C)===null?null:{fingerprint:await n(e(this,C)),info:{timezone:e(this,C)}}}}C=new WeakMap,N=new WeakSet,st=function(){const a=-new Date().getTimezoneOffset(),s=a>=0?"+":"-",o=Math.floor(Math.abs(a)/60).toString().padStart(2,"0"),u=(Math.abs(a)%60).toString().padStart(2,"0");return`UTC${s}${o}:${u}`};const ht=async i=>i.enabled?await i.support()?await i.data():(console.log(`Feature ${i.name} is not supported`),null):(console.log(`Feature ${i.name} is disabled`),null),ft=async()=>{const i=await dt();return await wt(i),i},dt=async()=>{const i=[new h,new k,new K,new Z,new ot,new ut,new lt,new ct],t=[],a={},s={};for(const u of i){const w=await ht(u);await m(w,"audio","audio",a),await m(w,"canvas","image",a),await m(w,"color gamut","colorGamut",a),await m(w,"hdr","hdr",a),await m(w,"hardware concurrency","hardwareConcurrency",a),await m(w,"languages","languages",a),await m(w,"screen resolution","screenResolution",a),await m(w,"timezone","timezone",a),w!=null&&w.fingerprint&&t.push(w.fingerprint)}const o=await pt();return o&&await gt(s,t,o),{id:await n(JSON.stringify(t)),ip:(o==null?void 0:o.ip)||!1,useragent:(o==null?void 0:o.headers["user-agent"])||!1,headers:(o==null?void 0:o.headers)||!1,rawData:a,serverFeature:s}};function m(i,t,a,s){var o;(o=i==null?void 0:i.info)!=null&&o[a]&&(s[t]={hash:i.fingerprint,value:i.info[a]})}async function gt(i,t,a){if(a!=null&&a.ip){const s=await n(a.ip);i["client ip"]={hash:s,value:a.ip},t.push(s)}}async function pt(){try{const t=await(await fetch("http://192.168.0.73:5173/api/fingerprint")).json();if(!t)throw new Error("failed to get user request info");return t.serverData}catch(i){console.error("failed to get user request info",i)}}async function wt(i){fetch("/api/fingerprint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}r.fpPromise=ft,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
