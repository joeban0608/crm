(function(r,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(r=typeof globalThis<"u"?globalThis:r||self,i(r.CRMFingerprint={}))})(this,function(r){"use strict";var Ht=Object.defineProperty;var lt=r=>{throw TypeError(r)};var Ot=(r,i,o)=>i in r?Ht(r,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[i]=o;var h=(r,i,o)=>Ot(r,typeof i!="symbol"?i+"":i,o),nt=(r,i,o)=>i.has(r)||lt("Cannot "+o);var a=(r,i,o)=>(nt(r,i,"read from private field"),o?o.call(r):i.get(r)),f=(r,i,o)=>i.has(r)?lt("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(r):i.set(r,o),g=(r,i,o,U)=>(nt(r,i,"write to private field"),U?U.call(r,o):i.set(r,o),o),Q=(r,i,o)=>(nt(r,i,"access private method"),o);var A,I,B,M,ut,ct,p,F,x,$,H,k,V,O,D,C,R,T,P,E,q,ft;const i="http://192.168.0.73:5173";function o(t){function e(d,m){return d>>>m|d<<32-m}const n=new TextEncoder().encode(t),s=Array.from(n),l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],u=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],w=s.length*8;for(s.push(128);(s.length*8+64)%512!==0;)s.push(0);const J=new Array(8).fill(0);for(let d=0;d<8;d++)J[7-d]=w>>>d*8&255;s.push(...J);const st=[];for(let d=0;d<s.length;d+=64)st.push(s.slice(d,d+64));return st.forEach(d=>{const m=new Array(64);for(let c=0;c<16;c++)m[c]=d[c*4]<<24|d[c*4+1]<<16|d[c*4+2]<<8|d[c*4+3];for(let c=16;c<64;c++){const tt=e(m[c-15],7)^e(m[c-15],18)^m[c-15]>>>3,et=e(m[c-2],17)^e(m[c-2],19)^m[c-2]>>>10;m[c]=m[c-16]+tt+m[c-7]+et|0}let[L,j,z,W,S,X,G,v]=u;for(let c=0;c<64;c++){const tt=e(S,6)^e(S,11)^e(S,25),et=S&X^~S&G,ot=v+tt+et+l[c]+m[c]|0,Mt=e(L,2)^e(L,13)^e(L,22),Ft=L&j^L&z^j&z,xt=Mt+Ft|0;v=G,G=X,X=S,S=W+ot|0,W=z,z=j,j=L,L=ot+xt|0}u[0]=u[0]+L|0,u[1]=u[1]+j|0,u[2]=u[2]+z|0,u[3]=u[3]+W|0,u[4]=u[4]+S|0,u[5]=u[5]+X|0,u[6]=u[6]+G|0,u[7]=u[7]+v|0}),u.map(d=>(d>>>0).toString(16).padStart(8,"0")).join("")}class U{constructor(){f(this,M);h(this,"name","Audio Feature");h(this,"enabled",!0);f(this,A,null);f(this,I,null);f(this,B,5e3)}async support(){const e=window.OfflineAudioContext||window.webkitOfflineAudioContext;return e?(g(this,A,new e(1,a(this,B),44100)),a(this,A)!==null):!1}async data(){if(a(this,A)===null)return null;const e=await Q(this,M,ut).call(this,a(this,A));return e===null?null:(g(this,I,e.toString()),{fingerprint:await o(a(this,I)),info:{audio:e}})}}A=new WeakMap,I=new WeakMap,B=new WeakMap,M=new WeakSet,ut=function(e){return new Promise(n=>{const s=e.createOscillator();s.type="triangle",s.frequency.value=1e4;const l=e.createDynamicsCompressor();l.threshold.value=-50,l.knee.value=40,l.ratio.value=12,l.attack.value=0,l.release.value=.2,s.connect(l),l.connect(e.destination),s.start(),e.oncomplete=u=>{const w=u.renderedBuffer.getChannelData(0),J=Q(this,M,ct).call(this,w);n(J)},e.startRendering()})},ct=function(e){let n=0;for(let s=0;s<e.length;++s)n+=Math.abs(e[s]);return n};class dt{constructor(){h(this,"name","Canvas Feature");h(this,"enabled",!0);f(this,p,null);f(this,F,null)}async support(){return document?(g(this,p,document.createElement("canvas").getContext("2d")),a(this,p)!==null):!1}async data(){return a(this,p)===null?null:(a(this,p).textBaseline="top",a(this,p).font="14px 'Arial'",a(this,p).textBaseline="alphabetic",a(this,p).fillStyle="#f60",a(this,p).fillRect(100,1,55,20),a(this,p).fillStyle="#069",a(this,p).fillText("Cyber Universe Canvas",2,15),a(this,p).fillStyle="rgba(102, 204, 0, 0.7)",a(this,p).fillText("Cyber Universe Canvas",4,17),g(this,F,a(this,p).canvas.toDataURL()),{fingerprint:await o(a(this,F)),info:{image:a(this,F)}})}}p=new WeakMap,F=new WeakMap;const N=class N{constructor(){h(this,"name","ColorGamut Feature");h(this,"enabled",!0);f(this,x,null);f(this,$,null)}async support(){return!0}async data(){for(const e of N.gamutList){const n=`(color-gamut: ${e})`;if(matchMedia(n).matches){g(this,x,`gamut: ${e}`),g(this,$,e);break}}return a(this,x)===null?null:{fingerprint:await o(a(this,x)),info:{colorGamut:a(this,$)}}}};x=new WeakMap,$=new WeakMap,h(N,"gamutList",["rec2020","p3","srgb"]);let Y=N;class ht{constructor(){h(this,"name","Hardware Concurrency Feature");h(this,"enabled",!0);f(this,H,null);f(this,k,null);f(this,V,null)}async support(){return!!navigator}async data(){return navigator.hardwareConcurrency&&(g(this,H,navigator.hardwareConcurrency.toString()),g(this,V,navigator.hardwareConcurrency)),a(this,H)?(g(this,k,"hardware concurrency: "+a(this,H)),{fingerprint:await o(a(this,k)),info:{hardwareConcurrency:a(this,V)}}):null}}H=new WeakMap,k=new WeakMap,V=new WeakMap;const _=class _{constructor(){h(this,"name","HDR Feature");h(this,"enabled",!0);f(this,O,null);f(this,D,null)}async support(){return!0}async data(){for(const e of _.hdrList){const n=`(dynamic-range: ${e})`;if(matchMedia(n).matches){g(this,O,`dynamic-range: ${e}`),g(this,D,e);break}}return a(this,O)===null?null:{fingerprint:await o(a(this,O)),info:{hdr:a(this,D)}}}};O=new WeakMap,D=new WeakMap,h(_,"hdrList",["high","standard"]);let Z=_;class gt{constructor(){h(this,"name","Languages Feature");h(this,"enabled",!0);f(this,C,[]);f(this,R,null)}async support(){return!!navigator}async data(){var e;return navigator.language&&a(this,C).push([navigator.language]),Array.isArray(navigator.languages)&&a(this,C).push(navigator.languages),(e=a(this,C))!=null&&e.length?(g(this,R,JSON.stringify(a(this,C))),{fingerprint:await o(a(this,R)),info:{languages:a(this,R)}}):null}}C=new WeakMap,R=new WeakMap;class pt{constructor(){h(this,"name","Screen resolution Feature");h(this,"enabled",!0);f(this,T,null);f(this,P,null)}async support(){if(!(window.OfflineAudioContext||window.webkitOfflineAudioContext))return!1;const n=window.screen;return n?(g(this,T,n),a(this,T)!==null):!1}async data(){if(a(this,T)===null)return null;const e=`${a(this,T).width} x ${a(this,T).height}`;return g(this,P,e),{fingerprint:await o(a(this,P)),info:{screenResolution:e}}}}T=new WeakMap,P=new WeakMap;class wt{constructor(){f(this,q);h(this,"name","Timezone Feature");h(this,"enabled",!0);f(this,E,null)}async support(){return!0}async data(){if(Intl.DateTimeFormat){const e=new Intl.DateTimeFormat().resolvedOptions().timeZone;g(this,E,e)}else g(this,E,Q(this,q,ft).call(this));return a(this,E)===null?null:{fingerprint:await o(a(this,E)),info:{timezone:a(this,E)}}}}E=new WeakMap,q=new WeakSet,ft=function(){const n=-new Date().getTimezoneOffset(),s=n>=0?"+":"-",l=Math.floor(Math.abs(n)/60).toString().padStart(2,"0"),u=(Math.abs(n)%60).toString().padStart(2,"0");return`UTC${s}${l}:${u}`};let K;const y=[],at=5e3;async function mt(t){const e=t.id;if(!e)throw new Error("visitorId is required when tracking");K=Date.now(),await rt(e,"init"),await window.addEventListener("beforeunload",()=>(console.log("beforeunload"),rt(e,"beforeunload"),null)),await yt(e)}function rt(t,e){const n=Date.now(),s=Math.round((n-K)/1e3);y.push({type:"pageView",createAt:new Date().toISOString(),details:{url:window.location.href,duration:s,viewType:e}}),it({visitorId:t,eventLogs:y}),y.length=0,K=Date.now()}async function it(t){try{await fetch(`${i}/api/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(e){console.error("Error sending logs:",e)}}function yt(t){const e=new Set;for(const n in window)n.startsWith("on")&&e.add(n.slice(2));e.forEach(n=>{window.addEventListener(n,s=>bt(s,t),!0)})}function bt(t,e){y.push({type:t.type,createAt:new Date().toISOString(),details:{url:window.location.href,referrer:document.referrer,clientX:t.clientX||null,clientY:t.clientY||null,key:t.key||null,target:{name:t.target instanceof HTMLElement?t.target.tagName:null,id:t.target instanceof HTMLElement?t.target.id:null,class:t.target instanceof HTMLElement?t.target.className:null,text:t.target instanceof HTMLElement?t.target.innerText:null,href:t.target instanceof HTMLAnchorElement?t.target.href:null,src:t.target instanceof HTMLImageElement?t.target.src:null,alt:t.target instanceof HTMLImageElement?t.target.alt:null,type:t.target instanceof HTMLInputElement?t.target.type:null,checked:t.target instanceof HTMLInputElement?t.target.checked:null,value:t.target instanceof HTMLInputElement?t.target.value:null,placeholder:t.target instanceof HTMLInputElement?t.target.placeholder:null,role:t.target instanceof HTMLElement?t.target.getAttribute("role"):null,ariaLabel:t.target instanceof HTMLElement?t.target.getAttribute("aria-label"):null,ariaRole:t.target instanceof HTMLElement?t.target.getAttribute("aria-role"):null,ariaPressed:t.target instanceof HTMLElement?t.target.getAttribute("aria-pressed"):null,ariaChecked:t.target instanceof HTMLElement?t.target.getAttribute("aria-checked"):null,ariaExpanded:t.target instanceof HTMLElement?t.target.getAttribute("aria-expanded"):null,ariaHidden:t.target instanceof HTMLElement?t.target.getAttribute("aria-hidden"):null}}}),y.length>=at&&(console.log(`event data >=${at}`,{visitorId:e,eventLogs:y}),it({visitorId:e,eventLogs:y}),y.length=0)}const Tt=async t=>t.enabled?await t.support()?await t.data():(console.log(`Feature ${t.name} is not supported`),null):(console.log(`Feature ${t.name} is disabled`),null),Et=async()=>{const t=await Lt();return await(await(await Ct(t)).json()).data},Lt=async()=>{const t=[new U,new dt,new Y,new Z,new ht,new gt,new pt,new wt],e=[],n={},s={};for(const u of t){const w=await Tt(u);await b(w,"audio","audio",n),await b(w,"canvas","image",n),await b(w,"color gamut","colorGamut",n),await b(w,"hdr","hdr",n),await b(w,"hardware concurrency","hardwareConcurrency",n),await b(w,"languages","languages",n),await b(w,"screen resolution","screenResolution",n),await b(w,"timezone","timezone",n),w!=null&&w.fingerprint&&e.push(w.fingerprint)}const l=await At();return l&&await St(s,e,l),{id:await o(JSON.stringify(e)),ip:(l==null?void 0:l.ip)||!1,useragent:(l==null?void 0:l.headers["user-agent"])||!1,headers:(l==null?void 0:l.headers)||!1,rawData:n,serverFeature:s}};function b(t,e,n,s){var l;(l=t==null?void 0:t.info)!=null&&l[n]&&(s[e]={hash:t.fingerprint,value:t.info[n]})}async function St(t,e,n){if(n!=null&&n.ip){const s=await o(n.ip);t["client ip"]={hash:s,value:n.ip},e.push(s)}}async function At(){try{const e=await(await fetch(`${i}/api/fingerprint`)).json();if(!e)throw new Error("failed to get user request info");return e.serverData}catch(t){console.error("failed to get user request info",t)}}async function Ct(t){return fetch(`${i}/api/fingerprint`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}r.fpPromise=Et,r.tracking=mt,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
